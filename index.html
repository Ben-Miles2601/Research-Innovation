<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Research & Innovation Site Map</title>

  <!-- Bootstrap -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background: #f8f9fa;
    }

    #tree, #sitemap {
      margin-top: 20px;
    }

    /* Sitemap cards */
    .sitemap-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 15px;
    }

    .sitemap-card {
      background: white;
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      transition: transform 0.2s;
    }

    .sitemap-card:hover {
      transform: translateY(-3px);
    }

    .sitemap-card h5 {
      margin-bottom: 10px;
      font-size: 1.1rem;
      color: #0d6efd;
    }

    .sitemap-card ul {
      padding-left: 20px;
      margin: 0;
    }

    .sitemap-card li {
      font-size: 0.95rem;
      margin-bottom: 5px;
    }

    /* D3 tree styling */
    .node circle {
      fill: #0d6efd;
      stroke: #fff;
      stroke-width: 2px;
    }

    .node text {
      font-size: 12px;
    }

    .link {
      fill: none;
      stroke: #ccc;
      stroke-width: 2px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="mb-4">Research & Innovation Site Map</h1>

    <!-- Controls -->
    <div class="d-flex gap-2 mb-3">
      <button id="treeBtn" class="btn btn-primary">Tree View</button>
      <button id="sitemapBtn" class="btn btn-secondary">Sitemap View</button>
    </div>

    <!-- Tree View -->
    <div id="tree"></div>

    <!-- Sitemap View -->
    <div id="sitemap" style="display:none;"></div>
  </div>

  <!-- D3.js -->
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script>
    // Load data
    fetch("site-data.json")
      .then((res) => res.json())
      .then((data) => {
        renderTree(data);
        renderSitemap(data);
      });

    // Switch views
    document.getElementById("treeBtn").addEventListener("click", () => {
      document.getElementById("tree").style.display = "block";
      document.getElementById("sitemap").style.display = "none";
    });
    document.getElementById("sitemapBtn").addEventListener("click", () => {
      document.getElementById("tree").style.display = "none";
      document.getElementById("sitemap").style.display = "block";
    });

    // TREE VIEW
    function renderTree(data) {
      const width = 900;
      const dx = 20;
      const dy = 200;

      const tree = d3.tree().nodeSize([dx, dy]);
      const root = d3.hierarchy(data);
      tree(root);

      let x0 = Infinity;
      let x1 = -x0;
      root.each((d) => {
        if (d.x > x1) x1 = d.x;
        if (d.x < x0) x0 = d.x;
      });

      const svg = d3
        .select("#tree")
        .append("svg")
        .attr("viewBox", [0, 0, width, x1 - x0 + dx * 2])
        .style("font", "12px sans-serif");

      const g = svg
        .append("g")
        .attr("transform", `translate(${dy / 3},${dx - x0})`);

      g.append("g")
        .attr("fill", "none")
        .attr("stroke", "#555")
        .attr("stroke-opacity", 0.4)
        .attr("stroke-width", 1.5)
        .selectAll("path")
        .data(root.links())
        .join("path")
        .attr(
          "d",
          d3
            .linkHorizontal()
            .x((d) => d.y)
            .y((d) => d.x)
        );

      const node = g
        .append("g")
        .attr("stroke-linejoin", "round")
        .attr("stroke-width", 3)
        .selectAll("g")
        .data(root.descendants())
        .join("g")
        .attr("transform", (d) => `translate(${d.y},${d.x})`);

      node
        .append("circle")
        .attr("fill", (d) => (d.children ? "#0d6efd" : "#198754"))
        .attr("r", 5);

      node
        .append("text")
        .attr("dy", "0.31em")
        .attr("x", (d) => (d.children ? -10 : 10))
        .attr("text-anchor", (d) => (d.children ? "end" : "start"))
        .text((d) => d.data.name)
        .clone(true)
        .lower()
        .attr("stroke", "white");
    }

    // SITEMAP VIEW
    function renderSitemap(data) {
      const container = document.getElementById("sitemap");
      const buildCards = (node, parent) => {
        if (node.children) {
          node.children.forEach((child) => buildCards(child, parent));
        } else {
          const card = document.createElement("div");
          card.className = "sitemap-card";
          card.innerHTML = `
            <h5>${node.name}</h5>
            ${
              node.children
                ? `<ul>${node.children
                    .map((c) => `<li>${c.name}</li>`)
                    .join("")}</ul>`
                : ""
            }
          `;
          parent.appendChild(card);
        }
      };
      const wrapper = document.createElement("div");
      wrapper.className = "sitemap-container";
      buildCards(data, wrapper);
      container.appendChild(wrapper);
    }
  </script>
</body>
</html>
